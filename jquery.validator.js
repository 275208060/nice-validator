/*! nice Validator 0.7.0
 * (c) 2012-2013 Jony Zhang <zj86@live.cn>, MIT Licensed
 * http://niceue.com/validator/
 */
!function(e,t){"use strict";function i(r,s){var n=this;return!n instanceof i?new i(r,s):(n.$el=e(r),n._init(r,s),t)}function r(e,t){var i=t?t===!0?this:t:r.prototype;if(P(e))for(var s in e)i[s]=n(e[s])}function s(e,t){var i=t?t===!0?this:t:s.prototype;if(P(e))for(var r in e){if(!e[r])return;i[r]=e[r]}}function n(t){switch(e.type(t)){case"function":return t;case"array":return function(e){return t[0].test(e.value)||t[1]||!1};case"regexp":return function(e){return t.test(e.value)}}}function a(t){var i="";return e.map(t.split(" "),function(e){i+=","+("#"===e.charAt(0)?e:'[name="'+e+'"]')}),i.substring(1)}function l(t){var i;if(t&&t.tagName){switch(t.tagName){case"INPUT":case"SELECT":case"TEXTAREA":case"BUTTON":case"FIELDSET":i=t.form||e(t).closest(".n-"+p);break;case"FORM":i=t;break;default:i=e(t).closest(".n-"+p)}return e(i).data(p)||e(i)[p]().data(p)}}function u(t,i){if(t.form&&null===B(t.form,F)){var r=l(t);r?(r._parse(t),e(t).trigger(i)):B(t,x,null)}}function o(i,r){var s=e.trim(B(i,x+"-"+r));if(s)return s=Function("return "+s)(),s?n(s):t}function f(e,t,i){var r=t.msg;return P(r)&&i&&(r=r[i]),H(r)||(r=B(e,"data-msg-"+i)||B(e,"data-msg")||""),r}function d(e){var t;return e&&(t=N.exec(e)),t?t[1]:""}function c(e){return"INPUT"===e.tagName&&"checkbox"===e.type||"radio"===e.type}function g(e){return Date.parse(e.replace(/\.|\-/g,"/"))}var h,p="validator",m="n-ok",v="n-error",_="n-tip",y="n-loading",b="n-valid",k="n-invalid",w="msg-box",M="aria-required",O="aria-invalid",x="data-rule",$="data-target",V="data-tip",A="data-inputstatus",F="novalidate",T=":verifiable",C=/(!?)\s?(\w+)(?:\[\s*(.*?\]?)\s*\]|\(\s*(.*?\)?)\s*\))?\s*(;|\||&)?/g,R=/(\w+)(?:\[\s*(.*?\]?)\s*\]|\(\s*(.*?\)?)\s*\))?/,E=/(?:([^:;\(\[]*):)?(.*)/,S=/[^\x00-\xff]/g,N=/^.*(top|right|bottom|left).*$/,q=/(?:(post|get):)?(.+)/i,j=/<|>/g,D=e.noop,I=e.proxy,L=e.isFunction,U=e.isArray,H=function(e){return"string"==typeof e},P=function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},W=!window.XMLHttpRequest,B=function(e,i,r){return r===t?e.getAttribute(i):(null===r?e.removeAttribute(i):e.setAttribute(i,""+r),t)},X=window.console||{log:D,info:D},J={debug:0,timely:1,theme:"default",ignore:"",focusInvalid:!0,msgWrapper:"span",msgMaker:function(e){var t,i={error:v,ok:m,tip:_,loading:y}[e.type];return t='<span class="msg-wrap '+i+'" role="alert">',t+=(e.arrow||"")+(e.icon||"")+'<span class="n-msg">'+e.msg+"</span>",t+="</span>"},msgIcon:'<span class="n-icon"></span>',msgArrow:"",msgClass:"",defaultMsg:"{0} is not valid.",loadingMsg:"Validating..."},Q={"default":{formClass:"n-default",msgClass:"n-right",showOk:""}};e.fn[p]=function(t){var r=this,s=arguments;return r.is(":input")?r:(!r.is("form")&&(r=this.find("form")),!r.length&&(r=this),r.each(function(){var r=e(this).data(p);if(r)if(H(t)){if("_"===t.charAt(0))return;r[t].apply(r,Array.prototype.slice.call(s,1))}else t&&(r._reset(!0),r._init(this,t));else new i(this,t)}),this)},e.fn.isValid=function(e,i){var r,s,n=l(this[0]);return n?(i===t&&(i=!0),n.checkOnly=i,r=this.is(":input")?this:this.find(T),s=n._multiValidate(r,function(t){L(e)&&e.call(null,t),n.checkOnly=!1}),L(e)?this:s):!0},e.expr[":"].verifiable=function(e){var t=e.nodeName.toLowerCase();return("input"===t&&!{submit:1,button:1,reset:1,image:1}[e.type]||"select"===t||"textarea"===t)&&e.disabled===!1&&null===B(e,F)},i.prototype={_init:function(i,n){var l,u,o,f=this;if(L(n)&&(n={valid:n}),n=n||{},o=B(i,"data-"+p+"-option"),o=o&&"{"===o.charAt(0)?Function("return "+o)():{},u=Q[n.theme||o.theme||J.theme],l=f.options=e.extend({},J,u,o,this.options,n),f.rules=new r(l.rules,!0),f.messages=new s(l.messages,!0),f.elements=f.elements||{},f.deferred={},f.errors={},f.fields={},f._initFields(l.fields),U(l.groups)&&e.map(l.groups,function(i){return H(i.fields)&&L(i.callback)?(i.$elems=f.$el.find(a(i.fields)),e.map(i.fields.split(" "),function(e){f.fields[e]=f.fields[e]||{},f.fields[e].group=i}),t):null}),f.msgOpt={type:"error",pos:d(l.msgClass),wrapper:l.msgWrapper,cls:l.msgClass,style:l.msgStyle,icon:l.msgIcon,arrow:l.msgArrow,show:l.msgShow,hide:l.msgHide},f.isAjaxSubmit=!1,l.valid||null===B(i,"action"))f.isAjaxSubmit=!0;else{var c=e[e._data?"_data":"data"](i,"events");c&&c.valid&&e.map(c.valid,function(e){return-1!==e.namespace.indexOf("form")?1:null}).length&&(f.isAjaxSubmit=!0)}f.$el.data(p)||(f.$el.data(p,f).addClass("n-"+p+" "+l.formClass).on("submit."+p+" validate."+p,I(f,"_submit")).on("reset."+p,I(f,"_reset")).on("showtip."+p,I(f,"_showTip")).on("validated.field."+p,T,I(f,"_validatedField")).on("validated.rule."+p,T,I(f,"_validatedRule")).on("focusin."+p+" click."+p+" showtip."+p,T,I(f,"_focus")).on("focusout."+p+" validate."+p,T,I(f,"_blur")).on("click."+p,"input:radio,input:checkbox",I(f,"_click")),l.timely>=2&&f.$el.on("keyup."+p+" paste."+p,T,I(f,"_blur")).on("change."+p,"select",I(f,"_click")),f.NOVALIDATE=B(i,F),B(i,F,F))},_initFields:function(t){var i=this;P(t)&&e.each(t,function(e,t){if(null===t){var r=i.elements[e];r&&i._resetElement(r,!0),delete i.fields[e]}else i.fields[e]=H(t)?{rule:t}:t}),i.$el.find(T).each(function(){i._parse(this)})},_parse:function(e){var t,i=this,r=e.name,s=B(e,x);s&&B(e,x,null),(e.id&&"#"+e.id in i.fields||!e.name)&&(r="#"+e.id),r&&(t=i.fields[r]||{},t.key=r,t.old={},t.rule=t.rule||s||"",t.rule&&(t.rule.match(/match|checked/)&&(t.must=!0),-1!==t.rule.indexOf("required")&&(t.required=!0,B(e,M,!0)),("timely"in t&&!t.timely||!i.options.timely)&&B(e,"notimely",!0),H(t.target)&&B(e,$,t.target),H(t.tip)&&B(e,V,t.tip),i.fields[r]=i._parseRule(t)))},_parseRule:function(e){var i=E.exec(e.rule);if(i)return e._v=0,e.display=i[1],i[2]&&(e.rules=[],i[2].replace(C,function(){var i=arguments;i[3]=i[3]||i[4],e.rules.push({not:"!"===i[1],method:i[2],params:i[3]?i[3].split(", "):t,or:"|"===i[5]})})),e},_multiValidate:function(i,r){var s=this,n=s.options;return s._multiValid=!0,n.ignore&&(i=i.not(n.ignore)),i.each(function(e,i){var r=s.getField(i);if(r)return s._validate(i,r),!s._multiValid&&n.stopOnError?!1:t}),e.when.apply(null,e.map(s.deferred,function(e){return e})).done(function(){r.call(s,s._multiValid)}),e.isEmptyObject(s.deferred)?s._multiValid:t},_submit:function(i,r){var s=this,n=s.options,a=i.target;if(h)return h=!1,t;if("only"!==r&&("validate"!==i.type||s.$el[0]===a)){if(i.preventDefault(),s.submiting)return L(s.submiting)&&s.submiting.call(s),t;if(!L(n.beforeSubmit)||n.beforeSubmit.call(s,a)!==!1){n.debug&&X.log("\n"+i.type+" form");var l="submit"===i.type;s._reset(),s.submiting=!0,s.isValid=t,s._multiValidate(s.$el.find(T),function(t){var i,r=t||2===n.debug?"valid":"invalid";if(!t){if(n.focusInvalid){var u="focus.field";W&&(u+=" "+u),s.$el.find(":input["+O+'="true"]:first').trigger(u)}i=e.map(s.errors,function(e){return e})}s.submiting=!1,L(n[r])&&n[r].call(s,a,i),s.$el.trigger(r+".form",[a,i]),t&&!s.isAjaxSubmit&&l&&(h=!0,a.submit())})}}},_reset:function(e){var t=this;t.errors={},e&&t.$el.find(T).each(function(e,i){t._resetElement(i)})},_resetElement:function(t,i){e(t).removeClass(b+" "+k),this.hideMsg(t),i&&B(t,M,null)},_focus:function(t){var i,r=this,s=t.target;if("showtip"!==t.type){if(t.isTrigger||r.submiting)return;if(""!==s.value&&"tip"===B(s,A))return;r.options.focusCleanup&&"error"===B(s,A)&&(e(s).removeClass(k),r.hideMsg(s))}i=B(s,V),i&&r.showMsg(s,{msg:i,type:"tip"})},_blur:function(t,i){var r,s,n=this,a=n.options,l=t.target,u=t.type,o=150;if(!i&&"paste"!==u){if("validate"===u)s=!0,o=0;else{if(B(l,"notimely"))return;if(a.timely>=2&&"keyup"!==u)return}if(a.ignore&&e(l).is(a.ignore))return;if("keyup"===u){var f=t.keyCode,d={8:1,9:1,16:1,32:1,46:1};if(9===f&&!l.value)return;if(48>f&&!d[f])return;o=a.timely>=100?a.timely:500}}r=n.getField(l),r&&(o?(r._t&&clearTimeout(r._t),r._t=setTimeout(function(){n._validate(l,r,s)},o)):n._validate(l,r,s))},_click:function(e){this._blur(e,!0)},_showTip:function(e){var t=this;t.$el[0]===e.target&&t.$el.find(T+"["+V+"]").each(function(){t.showMsg(this,{msg:B(this,V),type:"tip"})})},_validatedField:function(t,i,r){var s=this,n=s.options,a=t.target,l=r.isValid=i.isValid=!!r.isValid,u=l?"valid":"invalid";r.key=i.key,r.rule=i._r,l?r.type="ok":(s.submiting&&(s.errors[i.key]=r.msg),s._multiValid=!1),i.old.value=a.value,i.old.id=a.id,s.elements[i.key]=a,s.$el[0].isValid=s.isValid=l?s.isFormValid():l,s.checkOnly||(L(i[u])&&i[u].call(s,a,r),e(a).attr(O,l?null:!0).removeClass(l?k:b).addClass(r.skip?"":l?b:k).trigger(u+".field",[r,s]),s.$el.triggerHandler("validation",[r,s]),(i.msgMaker||n.msgMaker)&&(!r.showOk&&r.msg||r.showOk&&n.showOk!==!1?s.showMsg(a,r,i):s.hideMsg(a,r,i)))},_validatedRule:function(i,r,s,n){var a,l,u,o=this,d=o.options,c=i.target,g="",h=!1,p=!1;if(n=n||{},r=r||o.getField(c),l=r._r,null===s)return e(c).trigger("validated.field",[r,{isValid:!0,skip:!0}]),t;if(s===!0||s===t?h=!0:(g=f(c,r,l),g||(H(s)?(g=s,s={error:g}):P(s)&&(s.error?g=s.error:(h=!0,s.ok&&H(s.ok)&&(p=!0),g=s.ok))),n.msg=(h?g:g||o.messages[l]||J.defaultMsg).replace("{0}",r.display||"")),r.rules&&(a=r.rules[r._v],a.not&&(h="required"===l||!h),a.or))if(h)for(;r.rules[r._v++].or&&r._v!==r.rules.length;);else u=!0;if(d.debug&&X.log("   "+r._v+": "+l+" => "+(n.msg||!0)),!u)if(h){if(n.isValid=!0,!p){var m=r.ok||B(c,"data-ok");m?(p=!0,n.msg=m):H(d.showOk)&&(p=!0,n.msg=d.showOk)}n.showOk=p,e(c).trigger("valid.rule",[l,n.msg])}else e(c).trigger("invalid.rule",[l,n.msg]);u||h&&r._v<r.rules.length-1?(r._v++,o._checkRule(c,r)):(r._v=0,e(c).trigger("validated.field",[r,n]))},_checkRule:function(i,r){var s,n,a=this,l=r.key,u=r.rules[r._v],d=u.method,c=u.params;if(!a.submiting||!a.deferred[l]){if(n=r.old,r._r=d,!r.must&&n.ret!==t&&n.rule===u&&n.id===i.id&&i.value&&n.value===i.value)s=n.ret;else{var g=o(i,d)||a.rules[d];s=g?g.call(a,i,c,r):f(i,r,d)||a.messages[d]}if(P(s)&&L(s.then)){var h=function(e){return H(e)||P(e)&&("error"in e||"ok"in e)?e:t};a.deferred[l]=s,!a.checkOnly&&a.showMsg(i,{type:"loading",msg:a.options.loadingMsg},r),s.then(function(s,l,o){var f,d=o.responseText,c=r.dataFilter||a.options.dataFilter;"json"===this.dataType?d=s:"{"===d.charAt(0)&&(d=e.parseJSON(d)||{}),L(c)?d=c(d):""===d?d=!0:(f=h(d),f===t&&(f=h(d.data)),d=f||!0),n.rule=u,n.ret=d,e(i).trigger("validated.rule",[r,d])},function(t,s){e(i).trigger("validated.rule",[r,s])}),r.isValid=t}else e(i).trigger("validated.rule",[r,s])}},_validate:function(i,r){if(!i.disabled&&null===B(i,F)){r.rules||this._parse(i);var s,n=this,a=n.options,l=e(i),u={},o=r.group,f=r.isValid=!0;if(a.debug&&X.info(r.key),o&&(s=o.callback.call(n,o.$elems),s!==t&&(n.hideMsg(o.target,{},r),s===!0?s=t:(H(s)&&(s={error:s}),r._v=0,r._r="group",f=!1,n.hideMsg(i,{},r),e.extend(u,o)))),f&&!r.required&&!r.must&&!i.value){if("tip"===B(i,A))return;if(!c(i))return l.trigger("validated.field",[r,{isValid:!0}]),t}s!==t?l.trigger("validated.rule",[r,s,u]):r.rule&&n._checkRule(i,r)}},_getMsgOpt:function(t){return e.extend({},this.msgOpt,H(t)?{msg:t}:t)},getField:function(e){var t,i=this;return t=e.id&&"#"+e.id in i.fields||!e.name?"#"+e.id:e.name,B(e,x)&&i._parse(e),i.fields[t]},test:function(e,i){var r,s,n,a=this,l=R.exec(i);return l&&(s=l[1],s in a.rules&&(n=l[2]||l[3],n=n?n.split(", "):t,r=a.rules[s].call(a,e,n))),r===!0||r===t||null===r||!1},getRangeMsg:function(e,t,i,r){if(t){var s=this,n=s.messages[i]||"",a=t[0].split("~"),l=a[0],u=a[1],o="rg",f=[""],d=+e===+e;if(2===a.length){if(l&&u){if(d&&e>=+l&&+u>=e)return!0;f=f.concat(a)}else if(l&&!u){if(d&&e>=+l)return!0;f.push(l),o="gt"}else if(!l&&u){if(d&&+u>=e)return!0;f.push(u),o="lt"}}else{if(e===+l)return!0;f.push(l),o="eq"}return n&&(r&&n[o+r]&&(o+=r),f[0]=n[o]),s.renderMsg.apply(null,f)}},renderMsg:function(){var e=arguments,t=e[0],i=e.length;if(t){for(;--i;)t=t.replace("{"+i+"}",e[i]);return t}},_getMsgDOM:function(t,i){var r,s,n,a=e(t);if(a.is(":input")?(n=i.target||B(t,$),n&&(n=this.$el.find(n),n.length&&(n.is(":input")?t=n.get(0):r=n)),r||(s=!c(t)&&t.id?t.id:t.name,r=this.$el.find(i.wrapper+"."+w+'[for="'+s+'"]'))):r=a,!r.length)if(a=this.$el.find(n||t),r=e("<"+i.wrapper+">").attr({"class":w+(i.cls?" "+i.cls:""),style:i.style||"","for":s}),c(t)){var l=a.parent();r.appendTo(l.is("label")?l.parent():l)}else r[i.pos&&"right"!==i.pos?"insertBefore":"insertAfter"](a);return r},showMsg:function(t,i,r){if(i=this._getMsgOpt(i),i.msg||i.showOk){t=e(t).get(0),e(t).is(T)&&(B(t,A,i.type),r=r||this.getField(t),r&&(i.style=r.msgStyle||i.style,i.cls=r.msgClass||i.cls,i.wrapper=r.msgWrapper||i.wrapper));var s=this._getMsgDOM(t,i),n=s[0].className;!N.test(n)&&s.addClass(i.cls),W&&"bottom"===i.pos&&(s[0].style.marginTop=e(t).outerHeight()+"px"),s.html(((r||{}).msgMaker||this.options.msgMaker).call(this,i)),s[0].style.display="",L(i.show)&&i.show.call(this,s,i.type)}},hideMsg:function(t,i,r){t=e(t).get(0),i=this._getMsgOpt(i),e(t).is(T)&&(B(t,A,null),B(t,O,null),r=r||this.getField(t),r&&(i.wrapper=r.msgWrapper||i.wrapper));var s=this._getMsgDOM(t,i);s.length&&(L(i.hide)?i.hide.call(this,s,i.type):s[0].style.display="none")},mapMsg:function(t){var i=this;e.each(t,function(e,t){var r=i.elements[e]||i.$el.find(':input[name="'+e+'"]')[0];i.showMsg(r,t)})},setMsg:function(e){new s(e,this.messages)},setRule:function(t){new r(t,this.rules),e.map(this.fields,function(e){e.old={}})},setField:function(e,t){var i={};H(e)?i[e]=t:P(e)&&(i=e),this._initFields(i)},isFormValid:function(){var e=this.fields;for(var t in e)if(!e[t].isValid)return e[t].isValid;return!0},holdSubmit:function(e){e===t&&(e=!0),this.submiting=e},cleanUp:function(){this._reset(1)},destroy:function(){this._reset(1),this.$el.off("."+p).removeData(p),B(this.$el[0],F,this.NOVALIDATE)}},e(document).on("focusin",":input["+x+"]",function(){u(this,"focusin")}).on("click","input,button",function(){if(this.form)if("submit"===this.type)null!==B(this,F)&&(h=!0);else if(this.name&&c(this)){var e=this.form.elements[this.name];e.length&&(e=e[0]),B(e,x)&&u(e,"validate")}}).on("submit validate","form",function(t){if(null===B(this,F)){var i,r=e(this);r.data(p)||(i=r[p]().data(p),e.isEmptyObject(i.fields)?(B(this,F,F),r.off("."+p).removeData(p)):i._submit(t))}}),new r({required:function(t,i){var r=e.trim(t.value),s=!0;if(i)if(1===i.length){if(!r&&!this.test(t,i[0]))return B(t,M,null),null;B(t,M,!0)}else"not"===i[0]&&e.map(i.slice(1),function(t){r===e.trim(t)&&(s=!1)});return s&&!!r},integer:function(e,t){var i,r="0|",s="[1-9]\\d*",n=t?t[0]:"*";switch(n){case"+":i=s;break;case"-":i="-"+s;break;case"+0":i=r+s;break;case"-0":i=r+"-"+s;break;default:i=r+"-?"+s}return i="^(?:"+i+")$",RegExp(i).test(e.value)||this.messages.integer[n]},match:function(t,i,r){if(i){var s,n,a,l,u,o,f,d="eq";if(1===i.length?a=i[0]:(d=i[0],a=i[1]),u="#"===a.charAt(0)?a:':input[name="'+a+'"]',o=this.$el.find(u)[0]){if(f=this.getField(o),s=t.value,n=o.value,r.init_match||(this.$el.on("valid.field."+p,u,function(){e(t).trigger("validate")}),r.init_match=f.init_match=1),!r.required&&""===s&&""===n)return null;if(i[2]&&("date"===i[2]?(s=g(s),n=g(n)):"time"===i[2]&&(s=+s.replace(":",""),n=+n.replace(":",""))),"eq"!==d&&!isNaN(+s)&&isNaN(+n))return!0;switch(l=this.messages.match[d].replace("{1}",f.display||a),d){case"lt":return+n>+s||l;case"lte":return+n>=+s||l;case"gte":return+s>=+n||l;case"gt":return+s>+n||l;case"neq":return s!==n||l;default:return s===n||l}}}},range:function(e,t){return this.getRangeMsg(+e.value,t,"range")},checked:function(t,i,r){if(c(t)){var s,n;return n=this.$el.find('input[name="'+t.name+'"]').filter(function(){return!s&&c(this)&&(s=this),!this.disabled&&this.checked&&e(this).is(":visible")}).length,i?this.getRangeMsg(n,i,"checked"):!!n||f(s,r,"checked")||this.messages.required}},length:function(e,t){var i=e.value,r=(t[1]?i.replace(S,"xx"):i).length;return t&&"~"===t[0].charAt(0)&&(t[0]="0"+t[0]),this.getRangeMsg(r,t,"length",t[1]?"_2":"")},remote:function(t,i){if(i){var r,s=this,n=q.exec(i[0]),a=n[2],l=(n[1]||"POST").toUpperCase(),u={};return u[t.name]=t.value,i[1]&&e.map(i.slice(1),function(t){u[e.trim(t)]=s.$el.find(':input[name="'+t+'"]').val()}),u=e.param(u),"POST"===l&&(r=a.indexOf("?"),-1!==r&&(u+="&"+a.substring(r+1,a.length),a=a.substring(0,r))),e.ajax({url:a,type:l,data:u,async:!0,cache:!1})}},filter:function(e,t){e.value=e.value.replace(t?RegExp("["+t[0]+"]","g"):j,"")}}),i.config=function(t){e.each(t,function(e,t){"rules"===e?new r(t):"messages"===e?new s(t):J[e]=t})},i.setTheme=function(t,i){P(t)?e.each(t,function(e,t){Q[e]=t}):H(t)&&P(i)&&(Q[t]=i)},e[p]=i}(jQuery);
