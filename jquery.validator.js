/*! nice Validator 0.7.0
 * (c) 2012-2014 Jony Zhang <zj86@live.cn>, MIT Licensed
 * http://niceue.com/validator/
 */
!function(e,t){"use strict";function i(s,n){var r=this;return!r instanceof i?new i(s,n):(r.$el=e(s),r._init(s,n),t)}function s(e,t){var i=t?t===!0?this:t:s.prototype;if(X(e))for(var n in e)i[n]=r(e[n])}function n(e,t){var i=t?t===!0?this:t:n.prototype;if(X(e))for(var s in e){if(!e[s])return;i[s]=e[s]}}function r(t){switch(e.type(t)){case"function":return t;case"array":return function(e){return t[0].test(e.value)||t[1]||!1};case"regexp":return function(e){return t.test(e.value)}}}function a(t){var i="";return e.map(t.split(" "),function(e){i+=","+("#"===e.charAt(0)?e:'[name="'+e+'"]')}),i.substring(1)}function l(t){var i;if(t&&t.tagName){switch(t.tagName){case"INPUT":case"SELECT":case"TEXTAREA":case"BUTTON":case"FIELDSET":i=t.form||e(t).closest("."+b);break;case"FORM":i=t;break;default:i=e(t).closest("."+b)}return e(i).data(m)||e(i)[m]().data(m)}}function u(e){var t,i=e.currentTarget;i.form&&null===Q(i.form,R)&&(t=l(i),t?(t._parse(i),t["_"+e.type](e)):Q(i,V,null))}function o(i,s){var n=e.trim(Q(i,V+"-"+s));if(n)return n=Function("return "+n)(),n?r(n):t}function d(e,t,i){var s=t.msg;return X(s)&&i&&(s=s[i]),B(s)||(s=Q(e,"data-msg-"+i)||Q(e,"data-msg")||""),s}function f(e){var t;return e&&(t=D.exec(e)),t?t[1]:""}function c(e){return"INPUT"===e.tagName&&"checkbox"===e.type||"radio"===e.type}function g(e){return Date.parse(e.replace(/\.|\-/g,"/"))}var p,m="validator",h="."+m,v=".rule",_=".field",y=".form",b="nice-"+m,k="n-ok",w="n-error",M="n-tip",O="n-loading",x="msg-box",$="aria-required",C="aria-invalid",V="data-rule",F="data-target",T="data-tip",A="data-inputstatus",R="novalidate",S=":verifiable",E=/(!?)\s?(\w+)(?:\[\s*(.*?\]?)\s*\]|\(\s*(.*?\)?)\s*\))?\s*(;|\||&)?/g,q=/(\w+)(?:\[\s*(.*?\]?)\s*\]|\(\s*(.*?\)?)\s*\))?/,N=/(?:([^:;\(\[]*):)?(.*)/,j=/[^\x00-\xff]/g,D=/^.*(top|right|bottom|left).*$/,I=/(?:(post|get):)?(.+)/i,U=/<|>/g,H=e.noop,L=e.proxy,P=e.isFunction,W=e.isArray,B=function(e){return"string"==typeof e},X=function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},J=!window.XMLHttpRequest,Q=function(e,i,s){return s===t?e.getAttribute(i):(null===s?e.removeAttribute(i):e.setAttribute(i,""+s),t)},z=window.console||{log:H,info:H},G={debug:0,timely:1,theme:"default",ignore:"",focusInvalid:!0,validClass:"n-valid",invalidClass:"n-invalid",msgWrapper:"span",msgMaker:function(e){var t,i={error:w,ok:k,tip:M,loading:O}[e.type];return t='<span class="msg-wrap '+i+'" role="alert">',t+=(e.arrow||"")+(e.icon||"")+'<span class="n-msg">'+e.msg+"</span>",t+="</span>"},msgIcon:'<span class="n-icon"></span>',msgArrow:"",msgClass:"",defaultMsg:"{0} is not valid.",loadingMsg:"Validating..."},K={"default":{formClass:"n-default",msgClass:"n-right",showOk:""}};e.fn[m]=function(t){var s=this,n=arguments;return s.is(":input")?s:(!s.is("form")&&(s=this.find("form")),!s.length&&(s=this),s.each(function(){var s=e(this).data(m);if(s)if(B(t)){if("_"===t.charAt(0))return;s[t].apply(s,Array.prototype.slice.call(n,1))}else t&&(s._reset(!0),s._init(this,t));else new i(this,t)}),this)},e.fn.isValid=function(e,i){var s,n,r=l(this[0]);return r?(i===t&&(i=!0),r.checkOnly=i,s=this.is(":input")?this:this.find(S),n=r._multiValidate(s,function(t){P(e)&&e.call(null,t),r.checkOnly=!1}),P(e)?this:n):!0},e.expr[":"].verifiable=function(e){var t=e.nodeName.toLowerCase();return("input"===t&&!{submit:1,button:1,reset:1,image:1}[e.type]||"select"===t||"textarea"===t)&&e.disabled===!1&&null===Q(e,R)},i.prototype={_init:function(i,r){var l,u,o,d=this;if(P(r)&&(r={valid:r}),r=r||{},o=Q(i,"data-"+m+"-option"),o=o&&"{"===o.charAt(0)?Function("return "+o)():{},u=K[r.theme||o.theme||G.theme],l=d.options=e.extend({},G,u,o,this.options,r),d.rules=new s(l.rules,!0),d.messages=new n(l.messages,!0),d.elements=d.elements||{},d.deferred={},d.errors={},d.fields={},d._initFields(l.fields),W(l.groups)&&e.map(l.groups,function(i){return B(i.fields)&&P(i.callback)?(i.$elems=d.$el.find(a(i.fields)),e.map(i.fields.split(" "),function(e){d.fields[e]=d.fields[e]||{},d.fields[e].group=i}),t):null}),d.msgOpt={type:"error",pos:f(l.msgClass),wrapper:l.msgWrapper,cls:l.msgClass,style:l.msgStyle,icon:l.msgIcon,arrow:l.msgArrow,show:l.msgShow,hide:l.msgHide},d.isAjaxSubmit=!1,l.valid||null===Q(i,"action"))d.isAjaxSubmit=!0;else{var c=e[e._data?"_data":"data"](i,"events");c&&c.valid&&e.map(c.valid,function(e){return-1!==e.namespace.indexOf("form")?1:null}).length&&(d.isAjaxSubmit=!0)}d.$el.data(m)||(d.$el.data(m,d).addClass(b+" "+l.formClass).on("submit"+h+" validate"+h,L(d,"_submit")).on("reset"+h,L(d,"_reset")).on("showtip"+h,L(d,"_showTip")).on("validated"+_+h,S,L(d,"_validatedField")).on("validated"+v+h,S,L(d,"_validatedRule")).on("focusin"+h+" click"+h+" showtip"+h,S,L(d,"_focusin")).on("focusout"+h+" validate"+h,S,L(d,"_focusout")).on("click"+h,":radio,:checkbox",L(d,"_click")),l.timely>=2&&d.$el.on("keyup"+h+" paste"+h,S,L(d,"_focusout")).on("change"+h,"select",L(d,"_click")),d._novalidate=Q(i,R),Q(i,R,R))},_initFields:function(t){var i=this;X(t)&&e.each(t,function(e,t){if(null===t){var s=i.elements[e];s&&i._resetElement(s,!0),delete i.fields[e]}else i.fields[e]=B(t)?{rule:t}:t}),i.$el.find(S).each(function(){i._parse(this)})},_parse:function(e){var t,i=this,s=e.name,n=Q(e,V);n&&Q(e,V,null),(e.id&&"#"+e.id in i.fields||!e.name)&&(s="#"+e.id),s&&(t=i.fields[s]||{},t.key=s,t.old={},t.rule=t.rule||n||"",t.rule&&(t.rule.match(/match|checked/)&&(t.must=!0),-1!==t.rule.indexOf("required")&&(t.required=!0,Q(e,$,!0)),("timely"in t&&!t.timely||!i.options.timely)&&Q(e,"notimely",!0),B(t.target)&&Q(e,F,t.target),B(t.tip)&&Q(e,T,t.tip),i.fields[s]=i._parseRule(t)))},_parseRule:function(e){var i=N.exec(e.rule);if(i)return e._v=0,e.display=i[1],i[2]&&(e.rules=[],i[2].replace(E,function(){var i=arguments;i[3]=i[3]||i[4],e.rules.push({not:"!"===i[1],method:i[2],params:i[3]?i[3].split(", "):t,or:"|"===i[5]})})),e},_multiValidate:function(i,s){var n=this,r=n.options;return n._multiValid=!0,r.ignore&&(i=i.not(r.ignore)),i.each(function(e,i){var s=n.getField(i);if(s)return n._validate(i,s),!n._multiValid&&r.stopOnError?!1:t}),e.when.apply(null,e.map(n.deferred,function(e){return e})).done(function(){s.call(n,n._multiValid)}),e.isEmptyObject(n.deferred)?n._multiValid:t},_submit:function(i,s){var n=this,r=n.options,a=i.target;if(p)return p=!1,t;if("only"!==s&&("validate"!==i.type||n.$el[0]===a)){if(i.preventDefault(),n.submiting)return P(n.submiting)&&n.submiting.call(n),t;if(!P(r.beforeSubmit)||r.beforeSubmit.call(n,a)!==!1){r.debug&&z.log("\n"+i.type+" form");var l="submit"===i.type;n._reset(),n.submiting=!0,n.isValid=t,n._multiValidate(n.$el.find(S),function(t){var i,s=t||2===r.debug?"valid":"invalid";t||(r.focusInvalid&&n.$el.find(":input["+C+'="true"]:first').trigger("focus"+_),i=e.map(n.errors,function(e){return e})),n.submiting=!1,P(r[s])&&r[s].call(n,a,i),n.$el.trigger(s+y,[a,i]),t&&!n.isAjaxSubmit&&l&&(p=!0,a.submit())})}}},_reset:function(e){var t=this;t.errors={},e&&t.$el.find(S).each(function(e,i){t._resetElement(i)})},_resetElement:function(t,i){var s=this.options;e(t).removeClass(s.validClass+" "+s.invalidClass),this.hideMsg(t),i&&Q(t,$,null)},_focusin:function(t){var i,s=this,n=s.options,r=t.target;if("showtip"!==t.type){if(t.isTrigger||s.submiting)return;if("error"===Q(r,A))n.focusCleanup&&(e(r).removeClass(n.invalidClass),s.hideMsg(r));else if(""!==r.value)return}i=Q(r,T),i&&s.showMsg(r,{msg:i,type:"tip"})},_focusout:function(t,i){var s,n,r=this,a=r.options,l=t.target,u=t.type,o=150;if(!i&&"paste"!==u){if("validate"===u)n=!0,o=0;else{if(Q(l,"notimely"))return;if(a.timely>=2&&"keyup"!==u)return}if(a.ignore&&e(l).is(a.ignore))return;if("keyup"===u){var d=t.keyCode,f={8:1,9:1,16:1,32:1,46:1};if(9===d&&!l.value)return;if(48>d&&!f[d])return;o=a.timely>=100?a.timely:500}}s=r.getField(l),s&&(o?(s._t&&clearTimeout(s._t),s._t=setTimeout(function(){r._validate(l,s,n)},o)):r._validate(l,s,n))},_click:function(e){this._focusout(e,!0)},_showTip:function(e){var t=this;t.$el[0]===e.target&&t.$el.find(S+"["+T+"]").each(function(){t.showMsg(this,{msg:Q(this,T),type:"tip"})})},_validatedField:function(t,i,s){var n=this,r=n.options,a=t.target,l=s.isValid=i.isValid=!!s.isValid,u=l?"valid":"invalid";s.key=i.key,s.rule=i._r,l?s.type="ok":(n.submiting&&(n.errors[i.key]=s.msg),n._multiValid=!1),i.old.value=a.value,i.old.id=a.id,n.elements[i.key]=a,n.$el[0].isValid=n.isValid=l?n.isFormValid():l,n.checkOnly||(P(i[u])&&i[u].call(n,a,s),e(a).attr(C,l?null:!0).removeClass(l?r.invalidClass:r.validClass).addClass(s.skip?"":l?r.validClass:r.invalidClass).trigger(u+_,[s,n]),n.$el.triggerHandler("validation",[s,n]),(i.msgMaker||r.msgMaker)&&(!s.showOk&&s.msg||s.showOk&&r.showOk!==!1?n.showMsg(a,s,i):n.hideMsg(a,s,i)))},_validatedRule:function(i,s,n,r){var a,l,u,o=this,f=o.options,c=i.target,g="",p=!1,m=!1;if(r=r||{},s=s||o.getField(c),l=s._r,null===n)return e(c).trigger("validated"+_,[s,{isValid:!0,skip:!0}]),t;if(n===!0||n===t?p=!0:(g=d(c,s,l),g||(B(n)?(g=n,n={error:g}):X(n)&&(n.error?g=n.error:(p=!0,n.ok&&B(n.ok)&&(m=!0),g=n.ok))),r.msg=(p?g:g||o.messages[l]||G.defaultMsg).replace("{0}",s.display||"")),s.rules&&(a=s.rules[s._v],a.not&&(p="required"===l||!p),a.or))if(p)for(;s.rules[s._v++].or&&s._v!==s.rules.length;);else u=!0;if(f.debug&&z.log("   "+s._v+": "+l+" => "+(r.msg||!0)),!u)if(p){if(r.isValid=!0,!m){var h=s.ok||Q(c,"data-ok");h?(m=!0,r.msg=h):B(f.showOk)&&(m=!0,r.msg=f.showOk)}r.showOk=m,e(c).trigger("valid"+v,[l,r.msg])}else e(c).trigger("invalid"+v,[l,r.msg]);u||p&&s._v<s.rules.length-1?(s._v++,o._checkRule(c,s)):(s._v=0,e(c).trigger("validated"+_,[s,r]))},_checkRule:function(i,s){var n,r,a=this,l=s.key,u=s.rules[s._v],f=u.method,c=u.params;if(!a.submiting||!a.deferred[l]){if(r=s.old,s._r=f,!s.must&&r.ret!==t&&r.rule===u&&r.id===i.id&&i.value&&r.value===i.value)n=r.ret;else{var g=o(i,f)||a.rules[f];n=g?g.call(a,i,c,s):d(i,s,f)||a.messages[f]}if(X(n)&&P(n.then)){var p=function(e){return B(e)||X(e)&&("error"in e||"ok"in e)?e:t};a.deferred[l]=n,!a.checkOnly&&a.showMsg(i,{type:"loading",msg:a.options.loadingMsg},s),n.then(function(n,l,o){var d,f=o.responseText,c=s.dataFilter||a.options.dataFilter;"json"===this.dataType?f=n:"{"===f.charAt(0)&&(f=e.parseJSON(f)||{}),P(c)?f=c(f):""===f?f=!0:(d=p(f),d===t&&(d=p(f.data)),f=d||!0),r.rule=u,r.ret=f,e(i).trigger("validated"+v,[s,f])},function(t,n){e(i).trigger("validated"+v,[s,n])}).always(function(){delete a.deferred[l]}),s.isValid=t}else e(i).trigger("validated"+v,[s,n])}},_validate:function(i,s){if(!i.disabled&&null===Q(i,R)){s.rules||this._parse(i);var n,r=this,a=r.options,l=e(i),u={},o=s.group,d=s.isValid=!0;if(a.debug&&z.info(s.key),o&&(n=o.callback.call(r,o.$elems),n!==t&&(r.hideMsg(o.target,{},s),n===!0?n=t:(B(n)&&(n={error:n}),s._v=0,s._r="group",d=!1,r.hideMsg(i,{},s),e.extend(u,o)))),d&&!s.required&&!s.must&&!i.value){if("tip"===Q(i,A))return;if(!c(i))return l.trigger("validated"+_,[s,{isValid:!0}]),t}n!==t?l.trigger("validated"+v,[s,n,u]):s.rule&&r._checkRule(i,s)}},test:function(e,i){var s,n,r,a=this,l=q.exec(i);return l&&(n=l[1],n in a.rules&&(r=l[2]||l[3],r=r?r.split(", "):t,s=a.rules[n].call(a,e,r))),s===!0||s===t||null===s||!1},getRangeMsg:function(e,t,i,s){if(t){var n=this,r=n.messages[i]||"",a=t[0].split("~"),l=a[0],u=a[1],o="rg",d=[""],f=+e===+e;if(2===a.length){if(l&&u){if(f&&e>=+l&&+u>=e)return!0;d=d.concat(a)}else if(l&&!u){if(f&&e>=+l)return!0;d.push(l),o="gt"}else if(!l&&u){if(f&&+u>=e)return!0;d.push(u),o="lt"}}else{if(e===+l)return!0;d.push(l),o="eq"}return r&&(s&&r[o+s]&&(o+=s),d[0]=r[o]),n.renderMsg.apply(null,d)}},renderMsg:function(){var e=arguments,t=e[0],i=e.length;if(t){for(;--i;)t=t.replace("{"+i+"}",e[i]);return t}},_getMsgOpt:function(t){return e.extend({},this.msgOpt,B(t)?{msg:t}:t)},_getMsgDOM:function(t,i){var s,n,r,a=e(t);if(a.is(":input")?(r=i.target||Q(t,F),r&&(r=this.$el.find(r),r.length&&(r.is(":input")?t=r.get(0):s=r)),s||(n=!c(t)&&t.id?t.id:t.name,s=this.$el.find(i.wrapper+"."+x+'[for="'+n+'"]'))):s=a,!s.length)if(a=this.$el.find(r||t),s=e("<"+i.wrapper+">").attr({"class":x+(i.cls?" "+i.cls:""),style:i.style||"","for":n}),c(t)){var l=a.parent();s.appendTo(l.is("label")?l.parent():l)}else s[i.pos&&"right"!==i.pos?"insertBefore":"insertAfter"](a);return s},showMsg:function(t,i,s){if(i=this._getMsgOpt(i),i.msg||i.showOk){t=e(t).get(0),e(t).is(S)&&(Q(t,A,i.type),s=s||this.getField(t),s&&(i.style=s.msgStyle||i.style,i.cls=s.msgClass||i.cls,i.wrapper=s.msgWrapper||i.wrapper));var n=this._getMsgDOM(t,i),r=n[0].className;!D.test(r)&&n.addClass(i.cls),J&&"bottom"===i.pos&&(n[0].style.marginTop=e(t).outerHeight()+"px"),n.html(((s||{}).msgMaker||this.options.msgMaker).call(this,i)),n[0].style.display="",P(i.show)&&i.show.call(this,n,i.type)}},hideMsg:function(t,i,s){t=e(t).get(0),i=this._getMsgOpt(i),e(t).is(S)&&(Q(t,A,null),Q(t,C,null),s=s||this.getField(t),s&&(i.wrapper=s.msgWrapper||i.wrapper));var n=this._getMsgDOM(t,i);n.length&&(P(i.hide)?i.hide.call(this,n,i.type):n[0].style.display="none")},mapMsg:function(t){var i=this;e.each(t,function(e,t){var s=i.elements[e]||i.$el.find(':input[name="'+e+'"]')[0];i.showMsg(s,t)})},setMsg:function(e){new n(e,this.messages)},setRule:function(t){new s(t,this.rules),e.map(this.fields,function(e){e.old={}})},getField:function(e){var t,i=this;return t=e.id&&"#"+e.id in i.fields||!e.name?"#"+e.id:e.name,Q(e,V)&&i._parse(e),i.fields[t]},setField:function(e,t){var i={};B(e)?i[e]=t:X(e)&&(i=e),this._initFields(i)},isFormValid:function(){var e=this.fields;for(var t in e)if(!e[t].isValid)return e[t].isValid;return!0},holdSubmit:function(e){this.submiting=e===t||e},cleanUp:function(){this._reset(1)},destroy:function(){this._reset(1),this.$el.off(h).removeData(m),Q(this.$el[0],R,this._novalidate)}},e(document).on("focusin",":input["+V+"]",function(e){u(e)}).on("click","input,button",function(e){var t=this;if(t.form)if("submit"===t.type)null!==Q(t,R)&&(p=!0);else if(t.name&&c(t)){var i=t.form.elements[t.name];i.length&&(i=i[0]),Q(i,V)&&u(e)}}).on("submit validate","form",function(t){if(null===Q(this,R)){var i,s=e(this);s.data(m)||(i=s[m]().data(m),e.isEmptyObject(i.fields)?(Q(this,R,R),s.off(h).removeData(m)):i._submit(t))}}),new s({required:function(t,i){var s=e.trim(t.value),n=!0;if(i)if(1===i.length){if(!s&&!this.test(t,i[0]))return Q(t,$,null),null;Q(t,$,!0)}else"not"===i[0]&&e.map(i.slice(1),function(t){s===e.trim(t)&&(n=!1)});return n&&!!s},integer:function(e,t){var i,s="0|",n="[1-9]\\d*",r=t?t[0]:"*";switch(r){case"+":i=n;break;case"-":i="-"+n;break;case"+0":i=s+n;break;case"-0":i=s+"-"+n;break;default:i=s+"-?"+n}return i="^(?:"+i+")$",RegExp(i).test(e.value)||this.messages.integer[r]},match:function(t,i,s){if(i){var n,r,a,l,u,o,d,f="eq";if(1===i.length?a=i[0]:(f=i[0],a=i[1]),u="#"===a.charAt(0)?a:':input[name="'+a+'"]',o=this.$el.find(u)[0]){if(d=this.getField(o),n=t.value,r=o.value,s.init_match||(this.$el.on("valid"+_+h,u,function(){e(t).trigger("validate")}),s.init_match=d.init_match=1),!s.required&&""===n&&""===r)return null;if(i[2]&&("date"===i[2]?(n=g(n),r=g(r)):"time"===i[2]&&(n=+n.replace(":",""),r=+r.replace(":",""))),"eq"!==f&&!isNaN(+n)&&isNaN(+r))return!0;switch(l=this.messages.match[f].replace("{1}",d.display||a),f){case"lt":return+r>+n||l;case"lte":return+r>=+n||l;case"gte":return+n>=+r||l;case"gt":return+n>+r||l;case"neq":return n!==r||l;default:return n===r||l}}}},range:function(e,t){return this.getRangeMsg(+e.value,t,"range")},checked:function(t,i,s){if(c(t)){var n,r;return r=this.$el.find('input[name="'+t.name+'"]').filter(function(){return!n&&c(this)&&(n=this),!this.disabled&&this.checked&&e(this).is(":visible")}).length,i?this.getRangeMsg(r,i,"checked"):!!r||d(n,s,"checked")||this.messages.required}},length:function(e,t){if(t){var i=e.value,s=(t[1]?i.replace(j,"xx"):i).length;return"~"===t[0].charAt(0)&&(t[0]="0"+t[0]),this.getRangeMsg(s,t,"length",t[1]?"_2":"")}},remote:function(t,i){if(i){var s,n=this,r=I.exec(i[0]),a=r[2],l=(r[1]||"POST").toUpperCase(),u={};return u[t.name]=t.value,i[1]&&e.map(i.slice(1),function(t){u[e.trim(t)]=n.$el.find(':input[name="'+t+'"]').val()}),u=e.param(u),"POST"===l&&(s=a.indexOf("?"),-1!==s&&(u+="&"+a.substring(s+1,a.length),a=a.substring(0,s))),e.ajax({url:a,type:l,data:u,async:!0,cache:!1})}},filter:function(e,t){e.value=e.value.replace(t?RegExp("["+t[0]+"]","gm"):U,"")}}),i.config=function(t){e.each(t,function(e,t){"rules"===e?new s(t):"messages"===e?new n(t):G[e]=t})},i.setTheme=function(t,i){X(t)?e.each(t,function(e,t){K[e]=t}):B(t)&&X(i)&&(K[t]=i)},e[m]=i}(jQuery);
